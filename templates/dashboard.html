<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Supervision Labo</title>
    {% load static %}
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: #eef2f7;
            margin: 0;
            padding: 0;
            color: #1f2937;
        }

        /* ===== Topbar ===== */
        .topbar {
            background: #2c3e50;
            color: white;
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .user-pill {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-logout {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 7px 18px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            text-decoration: none;
        }

        .btn-logout:hover {
            background: #c0392b;
        }

        /* ===== Container ===== */
        .container {
            padding: 25px;
            max-width: 1200px;
            margin: auto;
        }

        h1 {
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            border-left: 6px solid #3b82f6;
            padding-left: 15px;
            padding-top: 6px;
            padding-bottom: 6px;
            border-radius: 4px;
            background-color: #f0f4ff;
            margin-bottom: 30px;
        }

        /* ===== Grid cards ===== */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            justify-content: center;
        }

        .card {
            background: white;
            padding: 25px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            margin-top: 0;
            margin-bottom: 12px;
            font-weight: 600;
            color: #2c3e50;
        }

        .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .timestamp {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .btn-blue,
        .btn-green {
            cursor: pointer;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .btn-blue {
            background-color: #3b82f6;
            color: white;
            padding: 10px 22px;
        }

        .btn-blue:hover {
            background-color: #1e40af;
            transform: translateY(-2px);
        }

        .btn-green {
            background-color: #27ae60;
            color: white;
            padding: 12px 28px;
        }

        .btn-green:hover {
            background-color: #1e8449;
            transform: translateY(-2px);
        }

        /* ===== Status badge ===== */
        .status-box {
            margin: 30px auto;
            padding: 22px 20px;
            border-radius: 20px;
            text-align: center;
            max-width: 800px;
            font-weight: 600;
            transition: background 0.3s, color 0.3s;
        }

        .ok {
            background-color: #d1fae5;
            color: #065f46;
        }

        .alert {
            background-color: #fee2e2;
            color: #991b1b;
        }

        /* ===== Op√©rateurs cards ===== */
        .op-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
            justify-content: center;
            align-items: flex-start;
        }

        .op-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            width: 300px;
            display: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .op-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
        }

        .op-card h4 {
            margin-top: 0;
            margin-bottom: 8px;
        }

        .op-card p {
            font-size: 0.85em;
        }

        textarea {
            width: 100%;
            height: 60px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #ccc;
            padding: 8px;
            resize: vertical;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .op-container {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>

<body>
    <div class="topbar">
        <div style="font-weight: bold; font-size: 1.2em;">üî¨ Supervision Labo IoT</div>
        <div class="user-pill">
            <span>Connect√© : <b>{{ request.user.username }}</b></span>
            <form action="{% url 'logout' %}" method="post" style="margin:0;">
                {% csrf_token %}
                <button type="submit" class="btn-logout">D√©connexion</button>
            </form>
        </div>
    </div>

    <div class="container">
        <h1>üìä Syst√®me de Surveillance DHT11</h1>

        <div class="grid">
            <div class="card">
                <h3>Temp√©rature</h3>
                <div id="temp" class="value">-- ¬∞C</div>
                <p id="temp-time" class="timestamp">--</p>
                <button class="btn-blue" onclick="location.href='{% url 'graph-temp' %}'">Graphique</button>
            </div>
            <div class="card">
                <h3>Humidit√©</h3>
                <div id="hum" class="value">-- %</div>
                <p id="hum-time" class="timestamp">--</p>
                <button class="btn-blue" onclick="location.href='{% url 'graph-hum' %}'">Graphique</button>
            </div>
        </div>

        <div id="incident-badge" class="status-box ok">
            <h2 id="incident-status" style="margin:0;">Syst√®me Op√©rationnel</h2>
            <p>Alertes cons√©cutives : <span id="incident-counter">0</span></p>
            <a href="{% url 'incident_archive' %}" style="color: inherit; font-weight: bold;">Acc√©der aux archives</a>
        </div>

        <div class="op-container">
            <div id="op1" class="op-card">
                <h4>Niveau 1 : Alerte Imm√©diate</h4>
                <p>Dernier com valid√© : <span id="op1_show">-</span></p>
                <textarea id="op1_comment" placeholder="Note d'intervention..."></textarea>
                <label><input type="checkbox" id="op1_ack"> Accuser r√©ception</label>
                <button id="op1_save" class="btn-blue">Enregistrer OP1</button>
                <p id="op1_ack_status"></p>
            </div>

            <div id="op2" class="op-card">
                <h4>Niveau 2 : Alerte > 3 mesures</h4>
                <p>Dernier com valid√© : <span id="op2_show">-</span></p>
                <textarea id="op2_comment"></textarea>
                <label><input type="checkbox" id="op2_ack"> Accuser r√©ception</label>
                <button id="op2_save" class="btn-blue">Enregistrer OP2</button>
                <p id="op2_ack_status"></p>
            </div>

            <div id="op3" class="op-card">
                <h4>Niveau 3 : Alerte Critique (> 6)</h4>
                <p>Dernier com valid√© : <span id="op3_show">-</span></p>
                <textarea id="op3_comment"></textarea>
                <label><input type="checkbox" id="op3_ack"> Accuser r√©ception</label>
                <button id="op3_save" class="btn-blue">Enregistrer OP3</button>
                <p id="op3_ack_status"></p>
            </div>
        </div>

        <div style="text-align:center; margin:40px 0;">
            <button onclick="location.href='{% url 'download_dht_csv' %}'" class="btn-green">üì• Exporter Donn√©es Capteur (CSV)</button>
        </div>
    </div>

    <script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>
